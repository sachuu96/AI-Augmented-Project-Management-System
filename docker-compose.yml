version: "3.9"
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_DB: app
      POSTGRES_PASSWORD: password
    ports: ["5432:5432"]
  redpanda:
    image: docker.redpanda.com/redpandadata/redpanda:v24.1.10
    command:
      [
        "redpanda",
        "start",
        "--overprovisioned",
        "--smp",
        "1",
        "--reserve-memory",
        "0M",
        "--check=false",
      ]
    ports: ["9092:9092", "9644:9644"]
  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: minio123
    ports: ["9000:9000", "9001:9001"]

  dynamodb:
      image: amazon/dynamodb-local
      container_name: dynamodb
      ports:
        - "8000:8000"
      command: "-jar DynamoDBLocal.jar -inMemory -sharedDb"

  dynamodb-admin:
    image: aaronshaf/dynamodb-admin
    container_name: dynamodb-admin
    ports:
      - "8001:8001"
    environment:
      DYNAMO_ENDPOINT: http://dynamodb:8000
    depends_on:
      - dynamodb

  web:
    image: node:22
    working_dir: /app/web
    volumes:
      - ./apps/web:/app/web
      - ./apps/web/node_modules:/app/web/node_modules
    command: npm run dev -- --host 0.0.0.0
    environment:
      VITE_API_URL: http://localhost:3000
      VITE_SSE_URL: http://localhost:3000/events/stream
    # depends_on:
    #   - api
    ports:
      - "5173:5173"